#!/usr/bin/env python3\n\"\"\"\nExample 2: Managing UTXOs and Checking Balance\n\nThis example shows how to:\n1. Create a UTXO set\n2. Add UTXOs to the set\n3. Check balance for an address\n4. Spend UTXOs\n5. Track UTXO state\n\"\"\"\n\nimport sys\nsys.path.insert(0, '..')\n\nfrom meshchain.utxo import UTXO, UTXOSet\nfrom meshchain.crypto import StealthAddress\n\n\ndef main():\n    print(\"=\" * 60)\n    print(\"MeshChain Example 2: Managing UTXOs and Balance\")\n    print(\"=\" * 60)\n    \n    # Step 1: Create a UTXO set\n    print(\"\\n1. Creating UTXO set...\")\n    utxo_set = UTXOSet()\n    print(f\"   UTXO set created (size: {utxo_set.size()})\")\n    \n    # Step 2: Create stealth addresses\n    print(\"\\n2. Creating stealth addresses...\")\n    alice = StealthAddress()\n    bob = StealthAddress()\n    charlie = StealthAddress()\n    \n    alice_addr = alice.get_address()\n    bob_addr = bob.get_address()\n    charlie_addr = charlie.get_address()\n    \n    print(f\"   Alice: {alice_addr.hex()}\")\n    print(f\"   Bob: {bob_addr.hex()}\")\n    print(f\"   Charlie: {charlie_addr.hex()}\")\n    \n    # Step 3: Create and add UTXOs\n    print(\"\\n3. Creating UTXOs...\")\n    \n    # Alice receives 1000 satoshis\n    utxo1 = UTXO(\n        utxo_id=b'\\x01' * 16,\n        amount=1000,\n        stealth_address=alice_addr,\n        block_height=1\n    )\n    utxo_set.add_utxo(utxo1)\n    print(f\"   Added UTXO 1: 1000 satoshis to Alice\")\n    \n    # Alice receives another 500 satoshis\n    utxo2 = UTXO(\n        utxo_id=b'\\x02' * 16,\n        amount=500,\n        stealth_address=alice_addr,\n        block_height=2\n    )\n    utxo_set.add_utxo(utxo2)\n    print(f\"   Added UTXO 2: 500 satoshis to Alice\")\n    \n    # Bob receives 2000 satoshis\n    utxo3 = UTXO(\n        utxo_id=b'\\x03' * 16,\n        amount=2000,\n        stealth_address=bob_addr,\n        block_height=2\n    )\n    utxo_set.add_utxo(utxo3)\n    print(f\"   Added UTXO 3: 2000 satoshis to Bob\")\n    \n    # Step 4: Check balances\n    print(\"\\n4. Checking balances...\")\n    alice_balance = utxo_set.get_balance(alice_addr)\n    bob_balance = utxo_set.get_balance(bob_addr)\n    charlie_balance = utxo_set.get_balance(charlie_addr)\n    \n    print(f\"   Alice balance: {alice_balance} satoshis\")\n    print(f\"   Bob balance: {bob_balance} satoshis\")\n    print(f\"   Charlie balance: {charlie_balance} satoshis\")\n    \n    # Step 5: Get unspent UTXOs for Alice\n    print(\"\\n5. Getting Alice's unspent UTXOs...\")\n    alice_utxos = utxo_set.get_unspent_utxos(alice_addr)\n    print(f\"   Alice has {len(alice_utxos)} unspent UTXOs\")\n    for i, utxo in enumerate(alice_utxos, 1):\n        print(f\"     UTXO {i}: {utxo.amount} satoshis (block {utxo.block_height})\")\n    \n    # Step 6: Spend a UTXO\n    print(\"\\n6. Spending a UTXO...\")\n    print(f\"   Alice spends UTXO 1 (1000 satoshis)\")\n    utxo_set.spend_utxo(b'\\x01' * 16)\n    \n    # Step 7: Check updated balance\n    print(\"\\n7. Checking updated balance...\")\n    alice_balance = utxo_set.get_balance(alice_addr)\n    print(f\"   Alice's new balance: {alice_balance} satoshis\")\n    print(f\"   (1000 spent, 500 remaining)\")\n    \n    # Step 8: Check UTXO set statistics\n    print(\"\\n8. UTXO Set Statistics:\")\n    print(f\"   Total UTXOs: {utxo_set.size()}\")\n    print(f\"   Unspent UTXOs: {utxo_set.unspent_count()}\")\n    print(f\"   Spent UTXOs: {utxo_set.size() - utxo_set.unspent_count()}\")\n    \n    # Step 9: Verify UTXO states\n    print(\"\\n9. Verifying UTXO states...\")\n    print(f\"   UTXO 1 is unspent: {utxo_set.is_unspent(b'\\x01' * 16)}\")\n    print(f\"   UTXO 2 is unspent: {utxo_set.is_unspent(b'\\x02' * 16)}\")\n    print(f\"   UTXO 3 is unspent: {utxo_set.is_unspent(b'\\x03' * 16)}\")\n    \n    print(\"\\n\" + \"=\" * 60)\n    print(\"UTXO management example completed!\")\n    print(\"=\" * 60)\n\n\nif __name__ == \"__main__\":\n    main()\n
